# π§Ύ μ¥μ•  λ³΄κ³ μ„: Redis μ¥μ• λ΅ μΈν• λ¶„μ‚°λ½ μ‹¤ν¨

---

## 1. μ¥μ•  μ”μ•½

- **μ¥μ• λ…**: Redis μ¥μ• λ΅ μΈν• λ¶„μ‚°λ½ λ―Έμ‘λ™ β†’ μ£Όλ¬Έ μ¤‘λ³µ μ²λ¦¬ λ° λ°μ΄ν„° μ¶©λ
- **μ¥μ•  μΌμ‹**: 2025λ…„ 6μ›” 5μΌ(μ) 10:22 ~ 11:35 (μ•½ 1μ‹κ°„ 13λ¶„)
- **μ¥μ•  μƒνƒ**: μΆ…λ£λ¨ (λ³µκµ¬ μ™„λ£)
- **μ„λΉ„μ¤ μν–¥λ„**:
    - μƒν’ μ¬κ³  μ°¨κ° λ΅μ§μ—μ„ λ¶„μ‚°λ½ λ―Έμ‘λ™ β†’ μ¬κ³  μμ λ°μƒ
    - μΏ ν° μ¤‘λ³µ λ°κΈ‰ λ° ν¬μΈνΈ μ¤‘λ³µ μ°¨κ° μ‚¬λ΅€ λ‹¤μ λ°μƒ
    - μ΄ 108κ±΄ μ¤‘λ³µ μ£Όλ¬Έ μ²λ¦¬ λ°μƒ
- **μ¥μ•  λ“±κΈ‰**: S1 (Critical)

## 2. μ¥μ•  μ›μΈ μ”μ•½

Redis λ‹¨μΌ λ…Έλ“μ— λ©”λ¨λ¦¬ κ³Όλ¶€ν•(OOM) λ°μƒ β†’ ν”„λ΅μ„Έμ¤ μΆ…λ£ β†’ λ¶„μ‚°λ½ λ―Έμ‘λ™ β†’ λ™μ‹μ„± μ μ–΄ μ‹¤ν¨λ΅ μΈν•΄ μ¬κ³ /μΏ ν°/ν¬μΈνΈ μ²λ¦¬ μ¤‘λ³µ λ°μƒ

## 3. μ¥μ•  μƒμ„Έ νƒ€μ„λΌμΈ

| μ‹κ°„ | λ‚΄μ©                                  |
| --- |-------------------------------------|
| 10:22 | Redis μ—°κ²° μ¤λ¥ λ‹¤μ λ°μƒ (connection refused) |
| 10:24 | λ¶„μ‚°λ½ κΈ°λ° μƒν’/μΏ ν°/ν¬μΈνΈ μ²λ¦¬ λ΅μ§μ—μ„ μμ™Έ λ‹¤μ λ°μƒ   |
| 10:28 | μ£Όλ¬Έ μ¤‘λ³µ λ° μ¬κ³  μμ ν„μƒ ν™•μΈ                 |
| 10:31 | Redis λ‹¨μΌ λ…Έλ“ λ‹¤μ΄ ν™•μΈ (OOM + ν”„λ΅μ„Έμ¤ λΉ„μ •μƒ μΆ…λ£) |
| 10:37 | Redis μ¬κΈ°λ™ μ‹λ„, μ‹¤ν¨                    |
| 10:42 | μ„μ‹ λ©”λ¨λ¦¬ κΈ°λ° λ΅μ»¬ λ½ μ μ©μΌλ΅ μΌλ¶€ νΈλμ­μ… λ³΄νΈ μ‹μ‘   |
| 10:55 | Redis ν™κ²½ κΈ΄κΈ‰ μ΅°μΉ ν›„ λ³µμ› μ‹μ‘              |
| 11:20 | μ‹ κ· μ£Όλ¬Έ μ •μƒν™” μ‹μ‘                        |
| 11:35 | μ „μ²΄ μ„λΉ„μ¤ μ •μƒν™” ν™•μΈ, μΈμ‹λνΈ μΆ…λ£ μ„ μ–Έ           |

## 4. μ¥μ•  μν–¥ λ¶„μ„

| ν•­λ© | μν–¥ |
| --- | --- |
| μ¤‘λ³µ μ£Όλ¬Έ μ | 108κ±΄ |
| μ¬κ³  μμ λ°μƒ μƒν’ | 34κ° |
| μ§μ ‘ λ§¤μ¶ μν–¥ | μ•½ XXXλ§ μ› μ¶”μ • |
| κ³ κ°μ„Όν„° λ¬Έμ | 37κ±΄ μ ‘μ (μ£Όλ¬Έ μ¤λ¥, μ¬κ³  μ—†μ λ“±) |

## 5. 5 Whys λ¶„μ„

| Why λ‹¨κ³„ | λ‚΄μ© |
| --- | --- |
| 1. μ™ μ£Όλ¬Έ μ¤‘λ³µ/μ¬κ³  μ¤λ¥κ°€ λ°μƒν–λ”κ°€? | λ¶„μ‚°λ½μ΄ μ‘λ™ν•μ§€ μ•μ•„ λ™μ‹μ— μ—¬λ¬ μ”μ²­μ΄ μ²λ¦¬λμ—μ |
| 2. μ™ λ¶„μ‚°λ½μ΄ μ‘λ™ν•μ§€ μ•μ•λ”κ°€? | Redis μΈμ¤ν„΄μ¤κ°€ λ‹¤μ΄λμ–΄ μ—°κ²° μ‹¤ν¨ λ°μƒ |
| 3. μ™ Redisκ°€ λ‹¤μ΄λμ—λ”κ°€? | OOM(Out Of Memory)μΌλ΅ μΈν• ν”„λ΅μ„Έμ¤ μΆ…λ£ |
| 4. μ™ λ©”λ¨λ¦¬κ°€ κ³Όλ„ν•κ² μ‚¬μ©λμ—λ”κ°€? | λ§λ£λμ§€ μ•μ€ μ„Έμ…/λ½ ν‚¤μ μ§€μ†μ  λ„μ  λ°μƒ |
| 5. μ™ λ§λ£ μ •μ±…μ΄ κ΄€λ¦¬λμ§€ μ•μ•λ”κ°€? | μλ™ λ§λ£ TTL μ„¤μ • λ„λ½ λ° μ£ΌκΈ°μ  μ‚­μ  μ •μ±… λ―Έμ μ© |

## 6. μ¥μ•  λ€μ‘ λ° λ³µκµ¬ μ΅°μΉ

1. **μ¥μ•  κ°μ§€ λ° μ•λ¦Ό**
    - Redis λ©”λ¨λ¦¬ μ‚¬μ©λ‰ κΈ‰μ¦μΌλ΅ μΈν• OOM κ²½κ³  λ°μƒ (Redis maxmemory limit μ΄κ³Ό)
    - λ¶„μ‚°λ½ νλ“ μ‹¤ν¨κ°€ κΈ‰μ¦ν•λ©° μ„λΉ„μ¤ API μ—λ¬μ¨ μƒμΉ κ°μ§€ (APM, λ΅κ·Έ κΈ°λ° κ²½λ³΄ λ™μ‹ λ°μƒ)
    - μ¥μ•  κ°μ§€ ν›„ **μ¥μ•  ν‹°μΌ“ μλ™ μƒμ„±** λ° **μΈμ‹λνΈ λ£Έ(Slack μ±„λ„) κ°μ„¤**
        - μ°Έμ—¬: λ°±μ—”λ“ κ°λ°ν€, μΈν”„λΌν€, QA, μ΄μ ν€
2. **μ›μΈ νμ•… λ° 1μ°¨ μ§„λ‹¨**
    - Redis μΈμ¤ν„΄μ¤ μƒνƒ μ κ²€ β†’ OOM command not allowed λ‹¤μ λ°μƒ
    - keys μ ν™•μΈ μ‹, λ¶„μ‚°λ½ ν‚¤ λ° μΌλ¶€ μΊμ‹ ν‚¤κ°€ κ³Όλ„ν•κ² μ μ§€λ¨μ„ ν™•μΈ
    - TTL λ„λ½ λλ” λΉ„μ •μƒ ν•΄μ λ΅ μΈν• ν‚¤ λ„μ μ΄ μ£Όμ” μ›μΈμΌλ΅ νμ•…λ¨
- 1μ°¨ λ³µκµ¬ μ‹λ„ (μ‹¤ν¨)
    - Redis ν”„λ΅μ„Έμ¤ μ¬μ‹μ‘ μ‹λ„ β†’ μ¬μ‹μ‘ μ§ν›„ λ™μΌ μ¤λ¥λ΅ μ¬μ¤‘λ‹¨
    - λ©”λ¨λ¦¬ ν™•λ³΄ μ„ν•΄ flushdb λ“± κ°•μ  μ΅°μΉ λ…Όμλμ—μΌλ‚, λ°μ΄ν„° λ³΄νΈ μ΄μλ΅ μ¤‘λ‹¨
- **μ„μ‹ λ€μ‘ μ΅°μΉ**
    - κ° λ„λ©”μΈ μ„λΉ„μ¤(API μ„λ²„) λ‚΄μ—μ„ λ¶„μ‚°λ½ λ―Έμ‘λ™ μ‹, **λ΅μ»¬ λ½(synchronized)μΌλ΅ λ€μ²΄ μ μ©**
        - μ°μ„  μ μ© λ€μƒ: μ¬κ³  μ°¨κ°, μ£Όλ¬Έ μƒμ„± λ΅μ§
        - μΌλ¶€ νΈλμ­μ… μ§€μ—° λ°μƒν•μ€μΌλ‚, μ¤‘λ³µ μ”μ²­ μ™„ν™”μ—λ” ν¨κ³Ό μμ
    - λ½ λ―Έλ³΄μ¥ λ„λ©”μΈ(μΏ ν°, ν¬μΈνΈ)μ€ μΌμ‹μ μΌλ΅ ν•΄λ‹Ή κΈ°λ¥ μ‚¬μ© μ ν•
- **Redis ν™κ²½ κΈ΄κΈ‰ μ΅°μΉ**
    - TTL λ„λ½ ν‚¤ μ •λ¦¬: μ„ν—λ„κ°€ λ‚®μ€ prefix ν‚¤ μ¤‘μ‹¬μΌλ΅ SCAN + DEL μν–‰
    - μ„λΉ„μ¤ μ½”λ“ Hotfix: λ½ ν‚¤ λ° μΊμ‹ ν‚¤ TTL μ μ© λ„λ½ λ¶€λ¶„ μ¦‰μ‹ ν¨μΉ λ°°ν¬
    - Redis μ¬κΈ°λ™ β†’ μ •μƒν™” ν™•μΈ
- **μ„λΉ„μ¤ μ •μƒν™” λ° ν›„μ† μ²λ¦¬**
    - API μ¤λ¥μ¨ λ° μ‘λ‹µμ‹κ°„ μ§€ν‘ νλ³µ ν™•μΈ
    - μ„λΉ„μ¤ μ™„μ „ μ •μƒν™” κ³µμ§€ λ° μΈμ‹λνΈ λ£Έ μΆ…λ£
    - μ¤‘λ³µ μ²λ¦¬λ **μ£Όλ¬Έ, μΏ ν°, ν¬μΈνΈ μ΄λ ¥**μ„ κΈ°μ¤€μΌλ΅ **μ •ν•©μ„± κ²€μ¦ λ° μ •λ¦¬μ© λ°°μΉ μν–‰**
        - μ£Όλ¬Έ μ¤‘λ³µκ±΄ β†’ μλ™ μ·¨μ† λ° μ‚¬μ©μ μ•λ¦Ό λ°μ†΅
        - ν¬μΈνΈ μ¤‘λ³µ μ°¨κ° β†’ λ³µκµ¬ λ° λ΅κ·Έ κΈ°λ΅

## 7. μ¥μ•  μ „ν μ „λµ

- **μ „ν μ‹μ **: Redis λ‹¤μ΄ 10λ¶„ ν›„, μ „μ²΄ μ κ΄€ λ¶€μ„μ— κ³µμ§€
- **μ „ν λ‚΄μ©**:
    - β€ν„μ¬ μΌλ¶€ μ£Όλ¬Έ μ„λΉ„μ¤μ—μ„ μ¤‘λ³µ μ”μ²­μ΄ λ°μƒν•  μ μμΌλ©°, μ›μΈμ€ λ‚΄λ¶€ λ¶„μ‚°λ½ μ‹μ¤ν…(Redis κΈ°λ°) μ¥μ• μ…λ‹λ‹¤. μ¥μ•  λ³µκµ¬λ¥Ό μ§„ν–‰ μ¤‘μ΄λ©° μ‹ κ· μ£Όλ¬Έμ€ μΌμ‹ μ¤‘λ‹¨ μ”μ²­λ“λ¦½λ‹λ‹¤.β€
        - μ—”μ§€λ‹μ–΄ λ²„μ „

          > μ£Όλ¬Έ μ„λΉ„μ¤μ Redis μ—°κ²°μ΄ λμ–΄μ Έ λ¶„μ‚°λ½ λ™μ‘μ— μ‹¤ν¨ν•κ³  μμµλ‹λ‹¤. μ΄λ΅ μΈν•΄ μΌλ¶€ μ£Όλ¬Έ μ”μ²­μ—μ„ μ¤‘λ³µ μ²λ¦¬ λ° λ°μ΄ν„° μ¶©λμ΄ λ°μƒ μ¤‘μ΄λ©°, μ¥μ•  μν–¥ λ²”μ„λ” μ£Όλ¬Έ μ²λ¦¬ API μ „μ²΄μ…λ‹λ‹¤. Redis λ³µκµ¬λ¥Ό μ‹λ„ μ¤‘μ΄λ©°, μ•½ 10λ¶„ λ‚΄λ΅ μ •μƒν™”λ  κ²ƒμΌλ΅ λ³΄μ…λ‹λ‹¤.
        
        - κΈ°νμ λ²„μ „

          > ν„μ¬ μ£Όλ¬Έ μ„λΉ„μ¤μ— μΌμ‹μ μΈ μ¥μ• κ°€ λ°μƒν•μ—¬ μΌλ¶€ μ‚¬μ©μμ μ£Όλ¬Έμ΄ μ¤‘λ³µ μ²λ¦¬λκ±°λ‚ μ‹¤ν¨ν•  μ μμµλ‹λ‹¤. λ‚΄λ¶€ μ‹μ¤ν…μ—μ„ μ£Όλ¬Έ μ²λ¦¬ μ•μ •μ„±μ„ μ„ν• ν•µμ‹¬ κµ¬μ„± μ”μ†(Redis)μ— λ¬Έμ κ°€ λ°μƒν•μ—¬ λ³µκµ¬ μ‘μ—…μ„ μ§„ν–‰ν•κ³  μμΌλ©°, μ•½ 10λ¶„ λ‚΄λ΅ μ •μƒν™”λ  μμ •μ…λ‹λ‹¤. μ„λΉ„μ¤ μ΄μ©μ— λ¶νΈμ„ λ“λ ¤ μ£„μ†΅ν•©λ‹λ‹¤.

## 8. μ¬λ° λ°©μ§€ λ€μ±…

### 8-1. Redis μ¥μ•  μ‹ fallback λ΅μ§ μ—¬λ¶€ λ° λ€μ‘ λ‚΄μ—­

#### π“ μ¥μ•  μ‹μ μ— fallback λ€μ‘μ΄ μμ—λ”κ°€?

- **λ¶€λ¶„μ μΌλ΅λ§ μ΅΄μ¬ν•¨**
- `μΏ ν° λ°κΈ‰`, `ν¬μΈνΈ μ°¨κ°/μ λ¦½`μ€ Redis κΈ°λ° λ¶„μ‚°λ½ μ‹¤ν¨ μ‹ μ²λ¦¬ μμ²΄κ°€ **λ°”λ΅ μ‹¤ν¨**ν•λ„λ΅ κµ¬ν„λμ–΄ μμ—μ β†’ fallback **μ—†μ**
- `μƒν’ μ¬κ³  μ°¨κ°` λ΅μ§μ—λ” **μ„μ‹λ΅ λ΅μ»¬ λ½ (JVM synchronized)** μ„ μ‚¬μ©ν•λ” fallback λ΅μ§μ΄ λ¶€λ¶„ μ μ©λμ–΄ μμ—μ β†’ **μΌλ¶€ λ™μ‹μ„± μ μ–΄ κ°€λ¥ν–μΌλ‚ μ™„μ „ν•μ§€ μ•μ**

#### π“Β μ¥μ•  μ‹μ μ— TTL μ„¤μ •μ΄ μμ—λ”κ°€?

- Redis λ©”λ¨λ¦¬ μ„κ³„μΉλ¥Ό μ΄κ³Όν•μ—¬ OOM(Out of Memory) λ°μƒ
- TTL λ―Έμ„¤μ • λλ” κ³Όλ„ν• TTLλ΅ μΈν•΄ **λ¶„μ‚°λ½ ν‚¤μ™€ κΈ°νƒ€ μΊμ‹ ν‚¤κ°€ λ¬΄μ ν• μ¶•μ **λ¨
- μ΄λ΅ μΈν•΄ **λ½ νλ“ λ¶κ°€**, μ„λΉ„μ¤ μ§€μ—° λ° μμ™Έ λΉλ°

### 8-2. ν›„μ† λ€μ‘ λ°©μ• (TTL & Fallback κΈ°μ¤€ κ°•ν™”)

#### π΅ Short-Term (1μ£Ό λ‚΄)

- [ ]  **λ¨λ“  λ¶„μ‚°λ½ ν‚¤μ— TTL κ°•μ  μ„¤μ • (μµλ€ 10μ΄ μ΄λ‚΄)**
- [ ]  κΈ°μ΅΄ λ¶„μ‚°λ½ μ½”λ“μ— TTL λ„λ½ μ—¬λ¶€ μλ™ μ κ²€ λ΅μ§ μ¶”κ°€
- [ ]  Redis λ©”λ¨λ¦¬ μ‚¬μ©λ‰ μ„κ³„μΉ μ•λ¦Ό λ° TTL λ¨λ‹ν„°λ§ λ€μ‹λ³΄λ“ κµ¬μ„±
- [ ]  Redis μ¥μ•  μ‹ λ½ μ‹¤ν¨ β†’ μμ™Έκ°€ μ•„λ‹ λ½ μ‹¤ν¨ β†’ λ΅μ»¬ λ½ λ€μ²΄ κµ¬μ΅° μ μ© (μ°μ„ μμ„ λ‚®μ€ νΈλμ­μ…λ¶€ν„°)
- [ ]  μ„λΉ„μ¤λ³„ fallback μ μ© μ—¬λ¶€ μ κ²€ λ° ν‘μ¤€ν™” μ²΄ν¬λ¦¬μ¤νΈ λ§λ ¨
- [ ]  λ½ νλ“ μ‹¤ν¨ μ‹ fallback κ°€λ¥ν• λ„λ©”μΈλ¶€ν„° orElseLocalLock() μ μ©

#### π  Mid-Term (1κ°μ›” λ‚΄)

- [ ]  **κ³µν†µ λ½ μ ν‹Έμ— TTL λ° fallback κΈ°λ³Έκ°’ μ„¤μ • κ°•μ ν™”**
- [ ]  TTL κΈ°λ° λ½μ ν•΄μ  λ„λ½ λ°©μ§€λ¥Ό μ„ν• νΈλμ­μ… μΆ…λ£ ν›„ μλ™ λ¦΄λ¦¬μ¦ κµ¬μ΅° μ μ©
- [ ]  Redis Keyspace notification κΈ°λ°μΌλ΅ λ½ λ„μ νƒμ§€ μ‹μ¤ν… κµ¬ν„
- [ ]  λ½ νλ“ μ‹¤ν¨ μ‹μ—λ„ μμ™Έλ¥Ό λ°μƒμ‹ν‚¤μ§€ μ•κ³  νμ‰ μ²λ¦¬ λλ” μ§€μ—° μ¬μ‹λ„ μ „λµ λ„μ…

#### π”µ Long-Term (λ¶„κΈ° λ‚΄)

- [ ]  λ½ μμ΅΄μ„± λ†’μ€ νΈλμ­μ…μ„ λ€μƒμΌλ΅ **λ½-λ¦¬μ¤(lock-less)** κµ¬μ΅° λ¦¬ν©ν† λ§ κ²€ν†  (μ΄λ²¤νΈ ν, SAGA ν¨ν„΄, DB λ‚™κ΄€μ  λ½ μ „ν™ λ“±)
- [ ]  Redisson κΈ°λ° κ³ κ°€μ© λ½ κµ¬ν„ μ‹ fallback λ΅μ§ ν¬ν•¨ν• κ³µν†µ μΈν„°νμ΄μ¤ μ„¤κ³„ (LockStrategy, FallbackPolicy)